<div class="cart-page container">
  <div class="head"><h1>Your Cart</h1><a routerLink="/products">Continue Shopping</a></div>

  <div *ngIf="loading" class="loading-container"><mat-spinner></mat-spinner></div>

  <div *ngIf="!loading && cartItems.length > 0" class="cart-layout">
    <div>
      <article class="cart-item" *ngFor="let item of cartItems">
        <img [src]="item.product.image" [alt]="item.product.name" (error)="onImageError($event)" />
        <div class="details">
          <h3>{{ item.product.name }}</h3>
          <p>{{ item.product.price | currency:'INR':'symbol':'1.0-0' }} / {{ item.product.unit || 'pack' }}</p>
        </div>
        <div class="qty">
          <button mat-icon-button (click)="updateQuantity(item.id, item.quantity - 1)"><mat-icon>remove</mat-icon></button>
          <span>{{ item.quantity }}</span>
          <button mat-icon-button (click)="updateQuantity(item.id, item.quantity + 1)"><mat-icon>add</mat-icon></button>
        </div>
        <strong>{{ item.subtotal | currency:'INR':'symbol':'1.0-0' }}</strong>
        <button mat-icon-button color="warn" (click)="removeItem(item.id)"><mat-icon>delete</mat-icon></button>
      </article>
    </div>

    <aside class="summary">
      <h2>Price Details</h2>
      <p><span>Subtotal</span><strong>{{ cartTotal | currency:'INR':'symbol':'1.0-0' }}</strong></p>
      <p><span>Delivery Fee</span><strong>{{ cartTotal > 500 ? 'FREE' : 'â‚¹40' }}</strong></p>
      <p class="total"><span>Total</span><strong>{{ (cartTotal > 500 ? cartTotal : cartTotal + 40) | currency:'INR':'symbol':'1.0-0' }}</strong></p>
      <a mat-raised-button color="primary" routerLink="/checkout">Proceed to Checkout</a>
    </aside>
  </div>

  <app-empty-state *ngIf="!loading && cartItems.length === 0" icon="shopping_cart" title="Cart is empty" message="Add items to place your order." actionText="Shop now" actionRoute="/products"></app-empty-state>
</div>
